<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <title>LegendariosMinas</title>
  <!--"https://pablozagnoli.github.io/pagLegen/"-->>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>

<body>

  <script type="text/javascript">
    const mp = new MercadoPago('APP_USR-185bfd07-2552-4ecd-990c-0abbac069d15');

    const bricksBuilder = mp.bricks();


    const renderPaymentBrick = async (bricksBuilder) => {
      const settings = {
        initialization: {
          amount: 100, // valor total a ser pago
        },
        customization: {
          paymentMethods: {
            creditCard: 'all',
            debitCard: 'all',
            bankTransfer: ['pix'],
          },
        },
        callbacks: {
          onReady: () => {
            /*
              Callback chamado quando o Brick estiver pronto.
              Aqui você pode ocultar loadings do seu site, por exemplo.
            */
          },
          onSubmit: ({ selectedPaymentMethod, formData }) => {
            // callback chamado ao clicar no botão de submissão dos dados
            // "https://localhost:5001/pagamentos/criar-pagameto"
            // "http://173.224.117.181:40/pagamentos/criar-pagameto"
            return new Promise((resolve, reject) => {
              fetch("https://localhost:5001/pagamentos/criar-pagameto", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData)
              })
                .then((response) => {

                  resolve();

                })
                .catch((error) => {
                  // lidar com a resposta de erro ao tentar criar o pagamento
                  reject();
                })
            });
          },
          onError: (error) => {
            // callback chamado para todos os casos de erro do Brick
            console.error(error + "OLA!");
          },
        },
      };



      try {
        window.paymentBrickController = await bricksBuilder.create(
          'payment',
          'containerDePagamento',
          settings
        );
      } catch (error) {
        let contator = 1;
        while (contator < 30) {
          window.paymentBrickController = await bricksBuilder.create(
            'payment',
            'containerpagamento',
            settings
          );
          contator++;
          console.log(contator)
        }
      }
    };

    try {
      setTimeout(6000);
      renderPaymentBrick(bricksBuilder);
    } catch (error) {
      let contator = 1;
      while (contator < 30) {
        setTimeout(6000);
        renderPaymentBrick(bricksBuilder);
        contator++;
        console.log(contator)
      }
    }

  </script>

  <app-root></app-root>
</body>

</html>
